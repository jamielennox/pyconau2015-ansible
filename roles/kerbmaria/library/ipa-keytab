#!/bin/bash

get_keytab() {
    _REALM=$1
    _IPA=$2
    _IPA_USER=$3
    _EUID=$4
    _DB_USER=$5

    _KEYTAB_FILE=/var/kerberos/krb5/user/$_EUID/client.keytab
    
    sudo mkdir -p /var/kerberos/krb5/user/$_EUID
    sudo chown $_IPA_USER:$_IPA_USER /var/kerberos/krb5/user/$_EUID
    sudo chmod 700 /var/kerberos/krb5/user/$_EUID
    if [-f  $_KEYTAB_FILE]
    then
	ipa-getkeytab -p $_IPA_USER@$_REALM -k $_KEYTAB_FILE -s $_IPA
	chcon -v --type=httpd_sys_content_t $_KEYTAB_FILE
	sudo chown $_IPA_USER:$_IPA_USER $_KEYTAB_FILE
    fi
}
